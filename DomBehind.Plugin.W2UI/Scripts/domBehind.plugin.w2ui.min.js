function ShowW2alert(n,t,i){return w2alert(n,t,i)}function ShowW2confirm(n,t,i,r){return w2confirm(n,t,i).no(function(){r&&r()})}var __extends,DomBehind;(function(n){var t;(function(t){var i=function(){function t(){}return t.SetValue=function(n,t){var r=n.attr("DateFormatted"),i;r||(n.attr("DateFormatted","true"),i=n.attr("DateFormat"),i||(i="yyyy/MM/dd"),n.w2field("date",{format:i}));n.val(t)},t.FormatProperty=n.Data.DependencyProperty.RegisterAttached("DateFormat",function(){},function(n,t){n.attr("DateFormat",t)},n.Data.UpdateSourceTrigger.Explicit,n.Data.BindingMode.OneWay),t.ValueProperty=n.Data.DependencyProperty.RegisterAttached("",function(n){return n.val()},function(n,i){t.SetValue(n,i)},n.Data.UpdateSourceTrigger.Explicit,n.Data.BindingMode.TwoWay),t.DateProperty=n.Data.DependencyProperty.RegisterAttached("",function(n){var t=n.val();return new Date(t)},function(n,i){var r;if(i instanceof Date){r=n.attr("DateFormat");r&&r==="yyyy/MM/dd"||n.w2field("date",{format:"yyyy/MM/dd"});var u=""+i.getFullYear(),f=new String(""+(i.getMonth()+1)).PadLeft(2,"0"),e=new String(""+i.getDate()).PadLeft(2,"0");n.val(u+"/"+f+"/"+e);r&&r!=="yyyy/MM/dd"&&n.w2field("date",{format:r})}else t.SetValue(n,i)},n.Data.UpdateSourceTrigger.Explicit,n.Data.BindingMode.TwoWay),t}();t.DatePicker=i})(t=n.Controls||(n.Controls={}))})(DomBehind||(DomBehind={})),function(n){var t;(function(t){var i=function(){function t(){this._engaged=!1}return t.Register=function(n){!n.Element},t.Rebuild=function(n,t){var i=t.ToArray(),r,u,f,e;return i.SequenceEqual(t.__oldArray)?!1:(t.__oldArray=i,$.each(i,function(n,t){t.recid=n}),r=i.Select(function(n){var i=n;return t.DisplayMemberPath&&(i=n[t.DisplayMemberPath]),{id:n.recid,text:i,obj:n}}),u={items:r,selected:{}},t.Current!=null&&(f=t.Current.recid,e=r.FirstOrDefault(function(n){return n.id===f}),u.selected=e),n.w2field("list",u),!0)},t.prototype.OnCurrentChanged=function(n,i){var u,r,o;if(!this._engaged)if(u=n.__element,r=u.Element,String.IsNullOrWhiteSpace(i.Name))t.Rebuild(r,n),r.data("w2field").refresh();else if(i.Name==="Current"){var f=r.data("w2field"),s=n.Current.recid,e=f.options.items;e instanceof Array&&(o=e.FirstOrDefault(function(n){return n.id===s}),r.data("selected",o),f.refresh())}},t.ItemsSourceProperty=n.Data.DependencyProperty.RegisterAttached("itemsSource",function(){},function(i,r){var u,f;if(r instanceof n.Data.ListCollectionView){if(!t.Rebuild(i,r))return;u=r.__element;u||(u=r.__element=new t);u.Element=i;u.Items=r;f=i.data("w2field");f.refresh();f.__Dropdown=u;i.off("change");i.on("change",function(){var t=i.data("selected").id,n;u._engaged=!0;try{n=r.ToArray().FirstOrDefault(function(n){return n.recid==t});u.Items.Select(n)}finally{u._engaged=!1}});r.PropertyChanged.RemoveHandler(u.OnCurrentChanged);r.PropertyChanged.AddHandler(u.OnCurrentChanged)}},n.Data.UpdateSourceTrigger.Explicit,n.Data.BindingMode.OneWay,function(n){t.Register(n)}),t}();t.Dropdown=i})(t=n.Controls||(n.Controls={}))}(DomBehind||(DomBehind={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t,i,f,r,u;(function(n){n[n.Text=1]="Text";n[n.Int=2]="Int";n[n.Double=3]="Double";n[n.Date=4]="Date";n[n.Hex=5]="Hex";n[n.Money=6]="Money";n[n.Currency=7]="Currency";n[n.Percent=8]="Percent";n[n.Alphanumeric=9]="Alphanumeric";n[n.Time=10]="Time";n[n.Color=11]="Color";n[n.List=12]="List";n[n.Combo=13]="Combo";n[n.Check=14]="Check";n[n.Checkbox=15]="Checkbox";n[n.Select=16]="Select"})(t=n.FieldType||(n.FieldType={})),function(n){n[n.Number=1]="Number";n[n.Currency=2]="Currency";n[n.Money=3]="Money";n[n.Percent=4]="Percent";n[n.Time=5]="Time";n[n.Date=6]="Date";n[n.Age=7]="Age";n[n.Toggle=8]="Toggle";n[n.CheckBox=9]="CheckBox"}(i=n.RenderType||(n.RenderType={}));f=function(){function t(n){this.Owner=n}return Object.defineProperty(t.prototype,"items",{get:function(){if(!this.itemSource)return null;if(!this.__items){var t=new n.LamdaExpression(this.Owner,this.itemSource);this.__items=t.GetValue()}return this.__items},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.__type||(this.__type=r.FieldTypeToString(this.fieldType)),this.__type},enumerable:!0,configurable:!0}),t}();r=function(r){function u(){var n=r!==null&&r.apply(this,arguments)||this;return n.Column=[],n.__id=0,n}return __extends(u,r),Object.defineProperty(u.prototype,"IsMultiSelect",{get:function(){return this.GridOption&&this.GridOption.multiSelect?!0:!1},enumerable:!0,configurable:!0}),u.prototype.GenerateRecId=function(){return++this.__id},Object.defineProperty(u.prototype,"SelectedObject",{get:function(){var t=this.Grid.getSelection(),n;return!t||t.length===0?null:(n=[],$.each(this.Grid.records,function(i,r){t.Any(function(n){return n===r.recid})&&n.push(r)}),this.IsMultiSelect)?n:n.FirstOrDefault()},enumerable:!0,configurable:!0}),u.prototype.AddColumn=function(n){this.Column.push(n)},u.prototype.Ensure=function(){var r=this,o=this.Element.attr("id"),h,e,c,l,s;o||(o=NewUid(),this.Element.attr("id",o));h=[];$.each(this.Column,function(n,e){e.renderType&&(e.renderType===i.CheckBox?(e.editable=$.extend(!0,e.editable,{fieldType:t.Checkbox}),h.push(e)):e.render=u.RenderTypeToString(e.renderType));e.editable&&(e.editable=$.extend(!0,new f(r.DataContext),e.editable))});e={name:o,columns:this.Column,show:{selectColumn:!1},multiSelect:!1,keyboard:!0};e.onChange=function(n){var i,t,u,f;r.Grid&&(i=n.column,t=r.Grid.columns[i],t&&(u=t.field,f=t.caption,h.Any(function(n){return n.field===u&&n.caption===f})&&n.preventDefault()))};e.onDblClick=function(n){return r.OnDoubleClick(r.DataContext,n)};this.GridOption.footerOption&&(e.show.footer=!0);this.GridOption.headerOption&&(e.show.toolbar=!0,this.GridOption.headerOption.add&&(e.show.toolbarAdd=!0,e.onAdd=function(n){return r.OnToolbarAdd(r.DataContext,n)}),this.GridOption.headerOption.edit&&(e.show.toolbarEdit=!0,e.onEdit=function(n){return r.OnToolbarEdit(r.DataContext,n)}),this.GridOption.headerOption.save&&(e.show.toolbarSave=!0,e.onSave=function(n){return r.OnToolbarSave(r.DataContext,n)}),this.GridOption.headerOption.delete&&(e.show.toolbarDelete=!0,e.onDelete=function(n){return r.OnToolbarDelete(r.DataContext,n)}));this.GridOption.multiSelect&&(e.multiSelect=!0);this.GridOption.dragAndDropRow&&(e.reorderRows=!0);c=this.Column.Where(function(n){return!Object.IsNullOrUndefined(n.advancedSearch)});c.Any()&&(e.multiSearch=!0,e.searches=c.Select(function(n){return{field:n.field,caption:n.caption,type:u.FieldTypeToString(n.advancedSearch)}}));this.Grid=this.Element.w2grid(e);l=n.Data.DependencyProperty.RegisterAttached("itemsSource",function(){var n,i,t;return r.ListCollectionView&&r.Grid&&(r.ListCollectionView.Current=null,n=r.Grid.getSelection(),n&&n.length==1&&(i=n[0],t=r.ListCollectionView.ToArray().FirstOrDefault(function(n){return n.recid===i}),t&&r.ListCollectionView.Select(t))),r.ListCollectionView},function(t,i){var e,u,f;if(i instanceof n.Data.ListCollectionView&&(r.ListCollectionView=i,e=t.attr("id"),u=w2ui[e],u)){if(f=i.ToArray(),u.records===f)return;$.each(f,function(n,t){r.RowInjection(t)});u.clear(!0);u.records=f;u.total=f.length;u.refresh();u.onClick=function(n){r.OnSelect(r.DataContext,n);var t=$("#grid_"+e+"_focus");t.focus()};i.PropertyChanged.RemoveHandler(r.OnCurrentChanged);i.PropertyChanged.AddHandler(r.OnCurrentChanged)}},n.Data.UpdateSourceTrigger.Explicit);s=this.NewAdd(new n.Data.DataBindingBehavior);s.Property=l;s.PInfo=this.ItemsSource;s.Element=this.Element;u.Refresh.AddHandler(function(){try{r.Grid.refresh()}catch(e){}})},u.prototype.SuppressListCollectionViewAction=function(t){this.ListCollectionView.Begin();t(this.ListCollectionView);this.ListCollectionView.ViewReflected=n.Data.ListCollectionView.ViewReflectedStatus.Reflected;this.ListCollectionView.End()},u.prototype.OnSelect=function(n,t){if(this.GridOption.onSelect){var r=t.recid,i=this.Grid.get(r);this.SuppressListCollectionViewAction(function(n){return n.Current=i});this.GridOption.onSelect(n,i)}},u.prototype.OnDoubleClick=function(n,t){var u,i,f,r;if(this.GridOption&&this.GridOption.onDoubleClick&&(u=this.Element.attr("id"),i=w2ui[u],i)){f=t.recid;r=i.get(f);this.SuppressListCollectionViewAction(function(n){return n.Current=r});this.GridOption.onDoubleClick(n,r)}},u.prototype.OnToolbarAdd=function(n,t){if(this.GridOption&&this.GridOption.headerOption&&this.GridOption.headerOption.add){var i=this.GridOption.headerOption.add(n,t);i&&this.AddRow(i)}},u.prototype.AddRow=function(n){this.RowInjection(n);this.Grid.records.push(n);this.Grid.total=this.Grid.records.length;this.SuppressListCollectionViewAction(function(t){return t.Add(n)});this.Grid.refresh(n.recid);this.Grid.select(n.recid);this.Grid.scrollIntoView(n.recid)},u.prototype.OnToolbarEdit=function(n,t){if(this.GridOption&&this.GridOption.headerOption&&this.GridOption.headerOption.edit){var i=t.recid,r=this.Grid.get(i);this.GridOption.headerOption.edit(n,r)}},u.prototype.OnToolbarSave=function(n,t){if(this.GridOption&&this.GridOption.headerOption&&this.GridOption.headerOption.save){var i=t.recid,r=this.Grid.get(i);this.GridOption.headerOption.save(n,r)}},u.prototype.OnToolbarDelete=function(n,t){var i=this;this.GridOption&&this.GridOption.headerOption&&this.GridOption.headerOption.delete&&(t.force||(this._deleteTargets=this.SelectedObject),t.done&&t.done(function(){i.GridOption.headerOption.delete(n,i._deleteTargets)}))},u.prototype.OnCurrentChanged=function(n,t){String.IsNullOrWhiteSpace(t.Name)?this.Grid&&this.Grid.refresh():t.Name==="Current"},u.FieldTypeToString=function(n){var i="text";switch(n){case t.Text:i="text";break;case t.Int:i="int";break;case t.Double:i="float";break;case t.Date:i="date";break;case t.Hex:i="hex";break;case t.Money:i="money";break;case t.Currency:i="currency";break;case t.Percent:i="percent";break;case t.Alphanumeric:i="alphanumeric";break;case t.Time:i="time";break;case t.Color:i="color";break;case t.List:i="list";break;case t.Combo:i="combo";break;case t.Check:i="check";break;case t.Checkbox:i="checkbox";break;case t.Select:i="select"}return i},u.RenderTypeToString=function(n){var t="";switch(n){case i.Number:t="number";break;case i.Currency:t="currency";break;case i.Money:t="money";break;case i.Percent:t="percent";break;case i.Time:t="time";break;case i.Date:t="date";break;case i.Age:t="age";break;case i.Toggle:t="toggle"}return t},u.prototype.ParseCellStyles=function(n){var r=JSON.parse(n),u=[],i,t,f;for(i in r)for(t=0;t<this.Column.length;t++)if(f=this.Column[t],f.field===i){u[t]=r[i];break}return u},u.prototype.RowInjection=function(t){var u=this,r,f,i;t&&(t.w2ui||(t.w2ui={}),t.recid=this.GenerateRecId(),this.RowStyleBinding&&(r=this.RowStyleBinding(t),String.IsNullOrWhiteSpace(r)||(t.w2ui.style=r),t.__rowStyleObserver||(i=n.Observable.Register(t,n.LamdaExpression.Path(this.RowStyleBinding)),i.PropertyChanged.Clear(),i.PropertyChanged.AddHandler(function(n){var i=n.recid,r=u.RowStyleBinding(n);t.w2ui.style=r;u.Grid.refreshRow(i)}),t.__rowStyleObserver=i)),this.CellStyleBinding&&(r=this.CellStyleBinding(t),String.IsNullOrWhiteSpace(r)||(t.w2ui.style=this.ParseCellStyles(r)),i=n.Observable.Register(t,n.LamdaExpression.Path(this.CellStyleBinding)),Object.IsNullOrUndefined(i)||(i.PropertyChanged.Clear(),i.PropertyChanged.AddHandler(function(n){var i=n.recid,r=u.CellStyleBinding(n);t.w2ui.style=u.ParseCellStyles(r);u.Grid.refreshRow(i)}))),this.RowClassBinding&&(r=this.RowClassBinding(t),String.IsNullOrWhiteSpace(r)||(t.w2ui.class=r),f=this.ParseExpressionPath(this.RowClassBinding),Object.IsNullOrUndefined(f)||(i=n.Observable.Register(t,f),i.PropertyChanged.Clear(),i.PropertyChanged.AddHandler(function(n){var i=n.recid,r=u.RowClassBinding(n);t.w2ui.class=r;u.Grid.refreshRow(i)}))),$.each(this.Column,function(i,r){if(r.convertTarget)var u=n.Observable.RegisterAttached(t,{marks:[r.field],wrapper:function(n){return r.convertTarget(n)}})}))},u.prototype.ParseExpressionPath=function(t){var i=null;try{i=n.LamdaExpression.Path(t)}catch(r){console.trace(r)}return i},u.Refresh=new n.TypedEvent,u.IsSpinningProperty=n.Data.DependencyProperty.RegisterAttached("w2ui.isSpinning",function(){},function(n,t){var r=n.attr("w2ui.isSpinning"),u,i;r==="true"&&t||(r!=="false"||t)&&(n.attr("w2ui.isSpinning",String(t)),u=n.attr("id"),i=w2ui[u],i&&(t?i.lock("",!0):i.unlock()))},n.Data.UpdateSourceTrigger.Explicit,n.Data.BindingMode.OneWay),u}(n.Data.BindingBehavior);n.W2GridBindingBehavior=r;u=function(t){function i(n){return t.call(this,n)||this}return __extends(i,t),Object.defineProperty(i.prototype,"DefaultOption",{get:function(){return{caption:"",field:"",size:null,min:"15",max:null,hidden:!1,hideable:!0,sortable:!0,searchable:!1,resizable:!0,attr:"",style:"",render:null,title:null,editable:null,frozen:!1,info:null}},enumerable:!0,configurable:!0}),i.prototype.ColumnBinding=function(t,i,r){var u=$.extend(!0,this.DefaultOption,r),f;return u.caption=t,u.field=n.LamdaExpression.Path(i),f=this.CurrentBehavior,f.AddColumn(u),this},i.prototype.RowStyleBinding=function(n){var t=this.CurrentBehavior;return t.RowStyleBinding=n,this},i.prototype.RowCssBinding=function(n){var t=this.CurrentBehavior;return t.RowClassBinding=n,this},i.prototype.CellStyleBinding=function(n){var t=this.CurrentBehavior;return t.CellStyleBinding=n,this},i}(n.BindingBehaviorBuilder);n.W2GridBindingBehaviorBuilder=u;n.BindingBehaviorBuilder.prototype.BuildGrid=function(t,i){var f,e,s,o;return i=$.extend(!0,{},i),f=this,e=f.Add(new r),e.NewAdd=function(n){return f.Add(n)},e.ItemsSource=new n.LamdaExpression(f.Owner.DataContext,t),e.GridOption=i,i.isSpinning&&(s=f.Add(new n.Data.DataBindingBehavior),s.Property=r.IsSpinningProperty,s.PInfo=new n.LamdaExpression(f.Owner.DataContext,i.isSpinning)),f.CurrentBehavior=e,o=new u(f.Owner),o.CurrentElement=f.CurrentElement,o.CurrentBehavior=f.CurrentBehavior,o}}(DomBehind||(DomBehind={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(){var i=t!==null&&t.apply(this,arguments)||this;return i.Bindings=new n.List,i}return __extends(i,t),Object.defineProperty(i.prototype,"CurrentElement",{get:function(){return this._currentElement},set:function(n){this._currentElement!==n&&(this._currentElement&&this.Unsubscribe(this._currentElement),this._currentElement=n,n&&this.Subscribe(n))},enumerable:!0,configurable:!0}),i.prototype.Unsubscribe=function(){this.Bindings&&$.each(this.Bindings.toArray(),function(t,i){var r=i.Binding;r.Element.off();r instanceof n.Data.ActionBindingBehavior&&r.Event.Clear()})},i.prototype.Subscribe=function(n){this.Bindings&&$.each(this.Bindings.toArray(),function(t,i){var r=i.Binding,f=i.Selector,u=n.find(f);u&&(r.Element=u,r.Ensure())})},Object.defineProperty(i.prototype,"LastBinding",{get:function(){var n=this.Bindings.last();return n?n.Binding:null},enumerable:!0,configurable:!0}),i.prototype.Close=function(){w2popup.close()},i.prototype.Show=function(){var n=this.CreateOption();w2popup.open(n)},i.prototype.Message=function(){var n=this.CreateOption();w2popup.message(n)},i.prototype.CreateOption=function(){var t=this.Element,i=this.FindTemplate(t),n;if(this.CurrentElement=i.clone(),this.CurrentElement)return this.UpdateTarget(),n=$.extend(!0,{},this.Option),n.body=this.CurrentElement,this.TitleExpression&&(n.title=this.TitleExpression.GetValue()),n},i.prototype.UpdateTarget=function(){this.Bindings&&$.each(this.Bindings.toArray(),function(t,i){i.Binding instanceof n.Data.DataBindingBehavior&&i.Binding.UpdateTarget()})},i.prototype.UpdateSource=function(){this.Bindings&&$.each(this.Bindings.toArray(),function(t,i){i.Binding instanceof n.Data.DataBindingBehavior&&i.Binding.UpdateSource()})},i.prototype.AddBinding=function(n,t){return this.Bindings.add({Binding:n,Selector:t}),n},i.prototype.FindTemplate=function(n){var r="content"in document.createElement("template"),t,i;return r?(t=n[0],i=$(t.content.querySelector("div")),i):(t=n[0],i=$(t.querySelector("div")),i)},i}(n.Data.DataBindingBehavior),i;n.TemplatePopup=t;i=function(i){function r(){return i!==null&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.Element=function(n){var t=this;return t.CurrentSelector=n,t},r.prototype.Binding=function(i,r,u,f){var e=this;if(e.CurrentBehavior instanceof t){var s=e.CurrentBehavior,h=e.CurrentElement,o=e.CurrentBehavior.AddBinding(new n.Data.DataBindingBehavior,e.CurrentSelector);o.DataContext=e.CurrentBehavior.DataContext;o.Property=i;o.PInfo=new n.LamdaExpression(this.Owner.DataContext,r);o.BindingPolicy.Trigger=Object.IsNullOrUndefined(f)?i.UpdateSourceTrigger:f;o.BindingPolicy.Mode=Object.IsNullOrUndefined(u)?i.BindingMode:u;e.CurrentBehavior=s;e.CurrentElement=h}return e},r.prototype.ConvertTarget=function(i){var u=this,r,f;if(u.CurrentBehavior instanceof t&&(r=u.CurrentBehavior.LastBinding,r)){if(r.BindingPolicy.Converter)throw new n.Exception("Another 'IValueConverter' has already been assigned.");f=new n.SimpleConverter;f.ConvertHandler=i;r.BindingPolicy.Converter=f}return u},r.prototype.ConvertSource=function(i){var u=this,r,f;if(u.CurrentBehavior instanceof t&&(r=u.CurrentBehavior.LastBinding,r)){if(r.BindingPolicy.Converter)throw new n.Exception("Another 'IValueConverter' has already been assigned.");f=new n.SimpleConverter;f.ConvertBackHandler=i;r.BindingPolicy.Converter=f}return u},r.prototype.BindingAction=function(i,r,u){var f,e;return u===void 0&&(u=!1),f=this,f.CurrentBehavior instanceof t&&(e=f.CurrentBehavior.AddBinding(new n.Data.ActionBindingBehavior,f.CurrentSelector),e.DataContext=f.CurrentBehavior.DataContext,e.Event=i.Create(),e.Action=r,e.ActionParameterCount=r.length,e.AllowBubbling=u),f},r.prototype.BindingPopupTitle=function(i){var r=this;return r.CurrentBehavior instanceof t&&(r.CurrentBehavior.TitleExpression=new n.LamdaExpression(r.CurrentBehavior.DataContext,i)),r},r.prototype.AddValidator=function(i){var r=this,u;return r.CurrentBehavior instanceof t&&(u=r.CurrentBehavior.LastBinding,u instanceof n.Data.DataBindingBehavior&&(i.Behavior=u,r.CurrentBehavior.BindingPolicy.Validators.add(i))),i},r}(n.Data.DataBindingBehaviorBuilder);n.PopupTemplateBindingBuilder=i;n.BindingBehaviorBuilder.prototype.BuildTemplatePopup=function(r,u){var f=this,o=f.Add(new t),s,e;return o.Element=f.CurrentElement,o.Option=u,s=new n.LamdaExpression(f.Owner.DataContext,r),s.SetValue(o),e=new i(f.Owner),e.CurrentBehavior=f.CurrentBehavior,e.CurrentElement=f.CurrentElement,e}}(DomBehind||(DomBehind={}));
//# sourceMappingURL=domBehind.plugin.w2ui.min.js.map